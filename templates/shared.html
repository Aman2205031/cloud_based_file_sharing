{% extends "base.html" %}
{% block content %}

<div class="container">
    <h1 class="title">ğŸ“‚ Shared Files</h1>

    <!-- ğŸ” Search Bar -->
    <div class="search-container">
        <input type="text" id="searchBar" placeholder="ğŸ” Search files..." onkeyup="searchFiles()">
        
        <!-- ğŸ“… Sort Options -->
        <label for="sort">Sort By:</label>
        <select id="sort" onchange="sortFiles()">
            <option value="latest">ğŸ“… Latest</option>
            <option value="oldest">ğŸ“† Oldest</option>
        </select>
    </div>

    <table id="filesTable">
        <thead>
            <tr>
                <th>ğŸ“¤ Sender</th>
                <th>ğŸ“ Message</th>
                <th>ğŸ“… Timestamp</th>
                <th>ğŸ“¥ Download</th>
                <th>ğŸ”„ Reshare</th>
                <th>ğŸ—‘ï¸ Delete</th>
            </tr>
        </thead>
        <tbody>
            {% for sender, message, timestamp in shared_files %}
            <tr>
                <td>{{ sender }}</td>
                <td>{{ message }}</td>
                <td class="timestamp">{{ timestamp }}</td>
                <td><button class="download-btn" onclick="downloadFile('{{ message }}')">ğŸ“¥ Download</button></td>
                <td><button class="reshare-btn" onclick="reshareFile('{{ sender }}', '{{ message }}')">ğŸ”„ Reshare</button></td>
                <td><button class="delete-btn" onclick="deleteFile('{{ message }}')">ğŸ—‘ï¸ Delete</button></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <p id="responseMessage"></p>
</div>

<style>
    /* ğŸ”¹ Container Styling */
    .container {
        max-width: 900px;
        margin: auto;
        text-align: center;
        padding: 20px;
    }

    .title {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 15px;
    }

    /* ğŸ”¹ Search & Sort Bar */
    .search-container {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
    }

    input, select {
        padding: 8px;
        font-size: 14px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    /* ğŸ”¹ Table Styling */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    th, td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: center;
    }

    th {
        background-color: #007bff;
        color: white;
    }

    tbody tr:hover {
        background-color: #f1f1f1;
    }

    /* ğŸ”¹ Button Styling */
    .download-btn, .reshare-btn, .delete-btn {
        padding: 8px 12px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .download-btn { background-color: #28a745; color: white; }
    .reshare-btn { background-color: #ffc107; color: black; }
    .delete-btn { background-color: #dc3545; color: white; }

    .download-btn:hover { background-color: #218838; }
    .reshare-btn:hover { background-color: #e0a800; }
    .delete-btn:hover { background-color: #c82333; }

</style>

<script>
// ğŸ” Search Function
function searchFiles() {
    let input = document.getElementById("searchBar").value.toLowerCase();
    let rows = document.querySelectorAll("#filesTable tbody tr");
    rows.forEach(row => {
        let text = row.innerText.toLowerCase();
        row.style.display = text.includes(input) ? "" : "none";
    });
}

// ğŸ“… Sorting Function
function sortFiles() {
    let table = document.getElementById("filesTable").getElementsByTagName("tbody")[0];
    let rows = Array.from(table.rows);
    let sortBy = document.getElementById("sort").value;
    
    rows.sort((a, b) => {
        let dateA = new Date(a.querySelector(".timestamp").innerText);
        let dateB = new Date(b.querySelector(".timestamp").innerText);
        return sortBy === "latest" ? dateB - dateA : dateA - dateB;
    });

    table.innerHTML = "";
    rows.forEach(row => table.appendChild(row));
}

// ğŸ“¥ Download File Function
function downloadFile(filename) {
    window.location.href = "/download/" + filename;
}

// ğŸ”„ Reshare File Function
function reshareFile(sender, filename) {
    let email = prompt("Enter recipient email:");
    if (!email) return;
    
    fetch("/share_file", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: email, filename: filename })
    })
    .then(response => response.json())
    .then(data => document.getElementById("responseMessage").innerText = data.message);
}

// ğŸ—‘ï¸ Delete File Function
function deleteFile(filename) {
    if (!confirm("Are you sure you want to delete this file?")) return;
    
    fetch("/delete/" + filename, { method: "DELETE" })
    .then(response => response.json())
    .then(data => {
        document.getElementById("responseMessage").innerText = data.message;
        location.reload();
    });
}
</script>
{% endblock %}
